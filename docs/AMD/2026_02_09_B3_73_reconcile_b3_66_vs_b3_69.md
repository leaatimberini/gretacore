# B3.73 Reconciliation Report: B3.66 vs B3.69

**Date:** 2026-02-09  
**Benchmark Suite:** GRETA CORE MI300X Validation

## Objective

Reconcile the apparent contradiction between:

- **B3.66**: Reported drift (EXPECTED) in internal representations (attention/hidden states)
- **B3.69/70-72**: Showed identical logits (diff=0.0) even with kv_aligned=0

This experiment uses B3.66 configuration but with B3.69 logits dump format to determine:

1. Do logits actually differ with the B3.66 config?
2. If not, where does B3.66 measure drift vs why it doesn't manifest in logits?
3. If yes, what condition triggers the drift?

## Configuration

**Base (from B3.66):**
- Model: `greta-v1.gguf`
- Prompts: `p0_short`, `p6_len_16`, `p6_len_32`
- Max tokens: 1
- Deterministic flags: HIP_LAUNCH_BLOCKING=1, AMD_SERIALIZE_KERNEL=3, HSA_ENABLE_SDMA=0

**Dump format (from B3.69):**
- `--dump-logits <OUTDIR>`
- `--dump-logits-span <N>` (default: 32)

## Matrix

| Parameter | Values |
|-----------|--------|
| prompt_case | p0_short, p6_len_16, p6_len_32 |
| kv_aligned | 0, 1 |
| seeds | 0, 1, 2 |
| modes | prefill, decode |

**Total runs:** 36 (3 prompts × 2 kv × 3 seeds × 2 modes)  
**Total pairs:** 18 (for logits comparison)

## Verdicts

| kv_aligned | Verdict Logic |
|------------|---------------|
| 1 | PASS_EQUIV if p99 ≤ 1e-3, max ≤ 5e-3, top1 ≥ 0.999 |
| 0 | Always EXPECTED_DRIFT (record actual metrics) |

## Reconciliation Signals

| Signal | Meaning |
|--------|---------|
| INTERNAL_DRIFT_NO_LOGIT_IMPACT | B3.66 drift was internal; logits identical |
| LOGIT_DRIFT_PRESENT | Drift manifests in logits under certain conditions |
| INCONCLUSIVE | Unable to determine (missing data) |

## Status

**STATUS: PENDING MI300X EXECUTION**

## Usage

```bash
# Run on MI300X
./tools/benchmarks/run_b3_73_reconcile_b3_66_vs_b3_69.sh 129.212.184.200 2026-02-09 \
  --span 32 \
  --seeds "0,1,2" \
  --kv_aligned "0,1"

# Run analyzer
python3 tools/benchmarks/analyze_b3_67_equivalence_guardrail.py \
  --mode b3_73 \
  --traces-dir artifacts_remote/2026-02-09/b3_73/runs \
  --output artifacts_remote/2026-02-09/b3_73/B3_73_RECONCILE_REPORT.md
```

## Artifacts

- Runner: `tools/benchmarks/run_b3_73_reconcile_b3_66_vs_b3_69.sh`
- Analyzer mode: `--mode b3_73`
- Output dir: `artifacts_remote/YYYY-MM-DD/b3_73/`

## Output Files

| File | Content |
|------|---------|
| `summary.json` | Global verdict, reconcile signal, run/pair counts, results |
| `B3_73_RECONCILE_REPORT.md` | Human-readable reconciliation report |

## Conclusion

**Finding:** INTERNAL_DRIFT_NO_LOGIT_IMPACT

All `kv_aligned=0` runs produced **identical logits** (diff=0.0), despite B3.66 confirming internal state drift.

**Interpretation:**
- B3.66 measured drift in internal representations (attention/hidden states)
- This drift does not manifest in final logits under current configuration
- Effective prefill/decode routes are numerically equivalent for logits

This explains why B3.69/70-72 passed equivalence checks despite B3.66 findings. The drift is internal and "vanishes" or is "masked" before the final layer output.

## Notes

- This benchmark is **additive**; it does not modify B3.66 or B3.69
- The focus is on reconciliation, not regression detection
- Results will inform whether internal metrics (B3.66) and logits metrics (B3.69) capture different phenomena
