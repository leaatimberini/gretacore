# B3.77 â€” Single-Point 32k Long-Context Attempt (MI300X)

## Objective
Attempt a single-point validation of the Greta engine at 32,768 tokens of context on AMD MI300X hardware. This probe aims to assess stability, VRAM pressure, and numerical equivalence between prefill and decode paths at this extreme length.

## Methodology
- **Runner:** `tools/benchmarks/run_b3_77_32k_single_point.sh`
- **Matrix:**
  - Context Length: 32768
  - Generation Length: 64 tokens
  - Logits Comparison Span: First 16 generated tokens
  - Data Type: BF16
  - KV Alignment: `kv_aligned=1`
- **Stop Conditions:**
  - **OOM:** Immediate termination and record `FAIL_OOM`.
  - **Timeout:** Abort if execution time exceeds 60 seconds (accommodating model load + 32k processing).
- **VRAM Monitoring:** Real-time sampling via `rocm-smi` every 1s.

## MI300X Results (2026-02-09)

| Context | KV | Peak VRAM (MB) | Max Logits Diff | P99 Logits Diff | Top-1 Agreement | Verdict |
|---------|----|----------------|-----------------|-----------------|-----------------|---------|
| 32768   | 1  | 17268          | 0.000000        | 0.000000        | 1.0000          | PASS_EQUIV |

## Interpretation
- **Stability:** The engine successfully completed the 32,768 token context prefill and decode phases without OOM or stability issues.
- **VRAM:** Peak VRAM remained stable around 17.2 GB for this context length on MI300X (80GB). For Llama-3-8B, this confirms that the KV cache management is efficient even at extreme lengths.
- **Numerics:** Bit-perfect equivalence (`diff=0.0`) was maintained, confirming that the `kv_aligned=1` logic scales robustly to the 32k limit.

## Execution Commands

### Runner
```bash
./tools/benchmarks/run_b3_77_32k_single_point.sh 129.212.184.200 2026-02-09
```

### Analyzer
```bash
python3 tools/benchmarks/analyze_b3_67_equivalence_guardrail.py \
    --traces-dir artifacts_remote/2026-02-09/b3_77/runs \
    --output artifacts_remote/2026-02-09/b3_77/report.md \
    --mode b3_77
```
