# B3.77 â€” Single-Point 32k Long-Context Attempt (MI300X)

## Objective
Attempt a single-point validation of the Greta engine at 32,768 tokens of context on AMD MI300X hardware. This probe aims to assess stability, VRAM pressure, and numerical equivalence between prefill and decode paths at this extreme length.

## Methodology
- **Runner:** `tools/benchmarks/run_b3_77_32k_single_point.sh`
- **Matrix:**
  - Context Length: 32768
  - Generation Length: 64 tokens
  - Logits Comparison Span: First 16 generated tokens
  - Data Type: BF16
  - KV Alignment: `kv_aligned=1`
- **Stop Conditions:**
  - **OOM:** Immediate termination and record `FAIL_OOM`.
  - **Timeout:** 600s per phase (Audit-ready policy).
- **VRAM Monitoring:** Real-time sampling via `rocm-smi` every 1s.

## Timeout Policy & Timing
- **Policy:** Explicit 600s prefill / 600s decode timeout enforced via `--foreground` wrapper.
- **Measured Wall Time:**
  - Prefill: 36.14s
  - Decode: 35.68s

## VRAM Sampling Method
- **Sampling Period:** 1s
- **Samples Count:** 66
- **Peak VRAM (MB):** 17095
- **Peak Timestamp Offset:** 34s (seconds from start of sampling)
- **Device Info:** AMD MI300X
- **Note:** 1s sampling; micro-spikes might not be captured.

## MI300X Results (2026-02-09)

| Context | KV | Peak VRAM (MB) | Max Logits Diff | Top-1 Agreement | Verdict |
|---------|----|----------------|-----------------|-----------------|---------|
| 32768   | 1  | 17095          | 0.000000        | 1.0000          | PASS_EQUIV |

## Interpretation
- **PASS_EQUIV @ ctx=32768; diff=0.0; top1=1.0**
- **Stability:** Successfully completed at 32k context without OOM.
- **VRAM Efficiency:** Peak VRAM of ~17.1GB confirms efficient memory management for Llama-3-8B on MI300X.
- **Numerics:** Bit-perfect agreement validates the KV cache logic at scale.

## Execution Commands

### Runner
```bash
./tools/benchmarks/run_b3_77_32k_single_point.sh 129.212.184.200 2026-02-09
```

### Analyzer
```bash
python3 tools/benchmarks/analyze_b3_67_equivalence_guardrail.py \
    --traces-dir artifacts_remote/2026-02-09/b3_77/runs \
    --output artifacts_remote/2026-02-09/b3_77/report.md \
    --mode b3_77
```
