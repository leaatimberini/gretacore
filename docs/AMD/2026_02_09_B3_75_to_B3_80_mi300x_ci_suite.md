# MI300X Clean CI Suite (B3.75 - B3.80)

**Date:** 2026-02-09
**Status:** COMPLETED (PASS) status:DONE
**Platform:** MI300X (Node: 129.212.184.200)

## Overview

This unified workstream establishes a robust, CI-grade regression testing suite for GRETA CORE on MI300X. It consolidates validation logic from B3.66-B3.74 into a single, reproducible harness.

## Components

### 1. Runner (`tools/benchmarks/run_b3_75_mi300x_ci_harness.sh`)
Standardized bash script orchestrating benchmark execution across defined profiles.
- **Key Features:**
  - Robust argument parsing
  - Deterministic environment enforcement (`HIP_LAUNCH_BLOCKING=1`, `AMD_SERIALIZE_KERNEL=3`)
  - Profile-based matrix expansion
  - Perf/Trace artifact generation
  - SSH ControlMaster for connection stability
- **Profiles:**
  - `smoke`: Fast sanity check (Span 32, BF16, KV=1, Single Prompt)
  - `nightly`: Balanced regression (Spans 32/128, BF16/FP16, KV=0/1, Seeds 0/1) - Perf Baseline
  - `full`: Exhaustive (Spans 32/128/512, 3 Seeds, All Prompts)
  - `stress`: High pressure (Span 1024)
  - `coverage`: Extended prompt set (Span 32)

### 2. Analyzer (`tools/benchmarks/analyze_b3_67_equivalence_guardrail.py --mode b3_75`)
Unified analysis verification tool.
- **Checks:**
  - **Completeness:** Verifies all config.json matrix cells are present.
  - **Correctness:** Logic Equivalence Gate (B3.69 standards: `diff=0.0`).
  - **Performance:** Regression detection against `baseline.json`.
  - **Internal Drift:** Monitoring for unexpected structural divergence (warn-only).

### 3. Baseline (`baselines/mi300x/b3_75_perf_baseline.json`)
Versioned reference file for performance metrics (Wall Time, Logits Size).

## Artifact Layout

Root: `artifacts_remote/<DATE>/b3_75_ci/`

```text
runs/
  config.json             # Manifest of expected runs
  profile_<name>/
    span_<N>/
      dtype_<type>/
        kv_<0|1>/
          seed_<S>/
            <prompt>/
              prefill/    # Execution Output
              decode/     # Execution Output
                logits.jsonl.gz
                internal.jsonl.gz (optional)
                perf.json
                metadata.json
```

## Regression Policy (B3.79)

**Exit Code 1 (FAILURE) if:**
1.  **INCOMPLETE:** Missing data for any declared matrix cell.
2.  **FAIL_EQUIV:** Logits difference > 0.0 for `kv_aligned=1`.
3.  **FAIL_PERF:** (Nightly/Full only) Performance degradation > `fail_pct` vs baseline.

**Exit Code 0 (PASS) if:**
- All checks pass, or valid warnings only (e.g., `EXPECTED_DRIFT` for `kv_aligned=0`, `BASELINE_MISSING`).

## Execution

```bash
# Smoke
./tools/benchmarks/run_b3_75_mi300x_ci_harness.sh 129.212.184.200 --profile smoke

# Nightly (Standard Regression)
./tools/benchmarks/run_b3_75_mi300x_ci_harness.sh 129.212.184.200 --profile nightly

# Analysis
python3 tools/benchmarks/analyze_b3_67_equivalence_guardrail.py \
  --mode b3_75 \
  --traces-dir artifacts_remote/2026-02-09/b3_75_ci/runs \
  --output artifacts_remote/2026-02-09/b3_75_ci/B3_75_CI_REPORT.md
```

## Results Log

| Profile | Date | Status | Notes |
|---------|------|--------|-------|
| Smoke | 2026-02-09 | PASS | Initial validation |
| Nightly | 2026-02-09 | PASS | 64/64 runs, 100% Equivalence |
| Stress | 2026-02-09 | PASS | 4/4 runs (Span 1024), Stable |
| Coverage | 2026-02-09 | PASS | 64/64 runs, 100% Equivalence | status:DONE
